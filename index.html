<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AliBaba Admin Dashboard</title>
    <link rel="stylesheet" href="styles.css?v=20250831">
</head>
<body>
    <!-- Header -->
    <div class="header">
        <div class="logo">AliBaba</div>
        <div class="header-actions">
            <button class="publish-btn" onclick="publishChanges()">Publish</button>
            <span id="signed-in-msg" class="signed-in-msg"></span>
            <button id="login-btn" class="auth-btn" type="button" onclick="login()">Login</button>
            <button id="logout-btn" class="auth-btn" type="button" onclick="logout()" style="display:none">Logout</button>
            <div class="user-avatar"></div>
        </div>
    </div>

    <!-- Main Container -->
    <div class="container">
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="sidebar-section">
                <div class="sidebar-title">Menu</div>
                <div class="sidebar-tabs">
                    <button class="tab-item active" aria-current="page">Products</button>
                    <button class="tab-item">Revenue</button>
                    <button class="tab-item">Rewards</button>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <div class="table-container">
                <div class="table-header">
                    <h2>Product Management <span id="product-count" class="product-count-badge"></span></h2>
                    <div class="header-actions">
                        <input type="file" id="csv-input" accept=".csv" hidden onchange="onCsvSelected(event)">
                        <button class="add-product-btn import-csv-btn" onclick="triggerCsvPick()">Import CSV</button>
                        <button class="add-product-btn" onclick="autoAssignImagesForAll()" title="Find free images for items without images">Auto Assign Images</button>
                        <button class="add-product-btn delete-btn" onclick="removeAllImages()" title="Remove all images from all products">Remove All Images</button>
                        <button class="add-product-btn" onclick="openAddProductModal()">Add Product</button>
                    </div>
                </div>
                
                
                <!-- Search Bar -->
                <div class="search-bar">
                    <div class="search-input-wrap">
                        <span class="search-icon">ðŸ”Ž</span>
                        <input id="product-search" type="text" class="search-input" placeholder="Search by name or barcode..." oninput="onSearchInput(event)">
                        <button type="button" class="search-clear" onclick="clearSearch()" aria-label="Clear search">âœ•</button>
                    </div>
                </div>
                
                <div id="loading" class="loading" style="display: none;">Loading products...</div>
                <div id="error-message"></div>
                
                <table id="products-table">
                    <thead>
                        <tr>
                            <th>Image</th>
                            <th>Name</th>
                            <th>Description</th>
                            <th>Availability</th>
                            <th>Barcode</th>
                            <th>Category</th>
                            <th>Area</th>
                            <th>Price</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="products-tbody">
                        <!-- Products will be loaded here -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Add/Edit Product Modal -->
    <div id="product-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="modal-title">Add Product</h3>
                <button class="close-btn" onclick="closeModal()">&times;</button>
            </div>
            
            <div id="modal-error"></div>
            
            <form id="product-form">
                <div class="form-group">
                    <label class="form-label">Name</label>
                    <input type="text" class="form-input" id="product-name" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Description</label>
                    <input type="text" class="form-input" id="product-description" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Category</label>
                    <select class="form-select" id="product-category" required>
                        <option value="option">option</option>
                        <option value="Fruits &amp; Veggies">Fruits &amp; Veggies</option>
                        <option value="Seafood">Seafood</option>
                        <option value="Bakery">Bakery</option>
                        <option value="Frozen Foods">Frozen Foods</option>
                        <option value="Beverages">Beverages</option>
                        <option value="Snacks">Snacks</option>
                        <option value="Infant Care">Infant Care</option>
                        <option value="Cereals &amp; Breakfast">Cereals &amp; Breakfast</option>
                        <option value="Meat &amp; Poultry">Meat &amp; Poultry</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Price ($)</label>
                    <div class="price-wrap">
                        <input type="number" class="form-input price-input" id="product-price" step="0.01" required>
                        <select class="form-select price-unit-select" id="product-price-unit" aria-label="Price unit">
                            <option value="piece">per piece</option>
                            <option value="lb">per lb</option>
                            <option value="oz">per oz</option>
                            <option value="g">per g</option>
                            <option value="kg">per kg</option>
                            <option value="gallon">per gallon</option>
                            <option value="dozen">per dozen</option>
                            <option value="loaf">per loaf</option>
                            <option value="bag">per bag</option>
                            <option value="bags">per bags</option>
                            <option value="carton">per carton</option>
                            <option value="block">per block</option>
                            <option value="jar">per jar</option>
                            <option value="cup">per cup</option>
                            <option value="box">per box</option>
                            <option value="pack">per pack</option>
                            <option value="can">per can</option>
                            <option value="bottle">per bottle</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Barcode</label>
                    <input type="text" class="form-input" id="product-barcode" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Availability</label>
                    <select class="form-select" id="product-availability" required>
                        <option value="In Stock">In Stock</option>
                        <option value="Out of Stock">Out of Stock</option>
                    </select>
                </div>

                <div class="form-group">
                    <label class="form-label">Area Location</label>
                    <select class="form-select" id="product-area" required>
                        <option value="A1">A1</option>
                        <option value="A2">A2</option>
                        <option value="A3">A3</option>
                        <option value="A4">A4</option>
                        <option value="A5">A5</option>
                        <option value="A6">A6</option>
                        <option value="A7">A7</option>
                        <option value="A8">A8</option>
                        <option value="A9">A9</option>
                        <option value="A10">A10</option>
                    </select>
                </div>

                <div class="form-group">
                    <label class="form-label">Scale need</label>
                    <label style="display:flex; align-items:center; gap:8px; font-size:14px; color:#333;">
                        <input type="checkbox" id="product-scale-need">
                        Requires scale
                    </label>
                </div>

                <!-- Images -->
                <div class="form-group">
                    <label class="form-label">Images (up to 2)</label>
                    <div class="image-picker">
                        <div class="image-carousel">
                            <button type="button" class="carousel-nav prev" onclick="carouselPrev()" aria-label="Previous image">â—€</button>
                            <div class="carousel-viewport">
                                <img id="carousel-image" alt="Preview" />
                                <div id="carousel-empty" class="carousel-empty">No image selected</div>
                            </div>
                            <button type="button" class="carousel-nav next" onclick="carouselNext()" aria-label="Next image">â–¶</button>
                        </div>
                        <div class="image-dots" id="image-dots"></div>

                        <div class="image-slots">
                            <div class="image-slot" id="slot-0">
                                <input type="file" id="file-0" accept="image/*" hidden onchange="onSelectImage(event, 0)">
                                <label for="file-0" class="slot-drop">Add/Replace Image 1</label>
                                <button type="button" class="slot-remove" onclick="removeImage(0)">Remove</button>
                            </div>
                            <div class="image-slot" id="slot-1">
                                <input type="file" id="file-1" accept="image/*" hidden onchange="onSelectImage(event, 1)">
                                <label for="file-1" class="slot-drop">Add/Replace Image 2</label>
                                <button type="button" class="slot-remove" onclick="removeImage(1)">Remove</button>
                            </div>
                        </div>
                        <div class="image-hint">Recommended minimum: 760 Ã— 600 px. Smaller images will be rejected. Any image format is allowed.</div>
                    </div>
                </div>

                <!-- Suggested Images -->
                <div class="form-group">
                    <label class="form-label">Suggested Images</label>
                    <div style="display:flex; gap:12px; align-items:center; margin-bottom:8px;">
                        <button type="button" class="add-product-btn" onclick="suggestImagesForCurrentProduct()" title="Find suggested images based on name and category">Find Suggestions</button>
                        <small style="color:#666;">Picks images with white background when possible.</small>
                    </div>
                    <div id="suggested-images" style="display:grid; grid-template-columns: repeat(auto-fill, minmax(120px, 1fr)); gap:10px;"></div>
                </div>
            </form>
            
            <div class="modal-actions">
                <button class="btn-cancel" onclick="closeModal()">Cancel</button>
                <button class="btn-save" onclick="saveProduct()">Save</button>
            </div>
        </div>
    </div>

    <script src="script.js?v=20250923-1"></script>
</body>
</html>
